export const israeliCities = [
  // ערים מרכזיות
  'תל אביב-יפו',
  'ירושלים',
  'חיפה',
  'ראשון לציון',
  'פתח תקווה',
  'אשדוד',
  'נתניה',
  'באר שבע',
  'בני ברק',
  'חולון',
  'רמת גן',
  'אשקלון',
  'רחובות',
  'בת ים',
  'בית שמש',
  'כפר סבא',
  'הרצליה',
  'חדרה',
  'מודיעין-מכבים-רעות',
  'נצרת',
  'לוד',
  'רמלה',
  'רעננה',
  'גבעתיים',
  'נהריה',
  'יבנה',
  'אור יהודה',
  'טבריה',
  'אילת',
  'עכו',
  'קרית גת',
  'קרית מוצקין',
  'קרית ביאליק',
  'קרית ים',
  'קרית שמונה',
  'דימונה',
  'מעלה אדומים',
  'כרמיאל',
  'יקנעם',
  'מגדל העמק',
  'שדרות',
  'אופקים',
  'נתיבות',
  'ערד',
  'מצפה רמון',
  'קצרין',
  'יתיר',
  'מיתר',
  'הוד השרון',
  'עפולה',
  'אריאל',
  'טירת כרמל',
  'קלנסווה',
  'סח\'נין',
  'טמרה',
  'באקה אל-גרבייה',
  'אום אל-פחם',
  'מעלות-תרשיחא',
  'שפרעם',
  'מגדל',
  'ירוחם',
  'ביתר עילית',
  'בית שאן',
  'מטולה',
  'קריית עקרון',
  'קריית מלאכי',
  'קריית עתידים',
  'נס ציונה',
  'זכרון יעקב',
  'פרדס חנה-כרכור',
  'יהוד-מונוסון',
  'גן יבנה',
  'גדרה',
  'מבשרת ציון',
  'אבן יהודה',
  'קדימה-צורן',
  'אלפי מנשה',
  'עמנואל',
  'בית אל',
  'אפרת',
  'גבעת שמואל',
  'קריית אונו',
  'סביון',
  'רמת השרון',
  
  // ערים נוספות חשובות
  'אלעד',
  'בית שמש',
  'מעלה אדומים',
  'גבעת זאב',
  'אור עקיבא',
  'נשר',
  'קריית טבעון',
  'מגדל העמק',
  'צפת',
  'רמת ישי',
  'מגאר',
  'כפר כנא',
  'דבוריה',
  'כפר תבור',
  'אכסאל',
  'נחף',
  'יפיע',
  'עראבה',
  'סכנין',
  'דיר אל-אסד',
  'פקיעין',
  'חורפיש',
  'כסרא-סמיע',
  'ג\'ת',
  'בסמת טבעון',
  'דאליית אל-כרמל',
  'עוספיה',
  'רכסים',
  'נווה שלום',
  'לטרון',
  'אבו גוש',
  'עין ראפה',
  'בית נקופה',
  'צור הדסה',
  'מבוא ביתר',
  'אלון שבות',
  'נוקדים',
  'תקוע',
  'כרמי צור',
  'בת עין',
  'רוש צורים',
  'אפרת',
  'גוש עציון',
  'אלעזר',
  'נווה דניאל',
  'מגדל עוז',
  'כפר עציון',
  'רוש צורים',
  'בית שמש',
  'מטה יהודה',
  'צרעה',
  'אבן ספיר',
  'נתיב הל"ה',
  'בית מאיר',
  'בית נחמיה',
  'תרום',
  'שורש',
  'נחושה',
  'אגור',
  'כסלון',
  'נחם',
  'גבעת יערים',
  'קרית יערים',
  'אבו גוש',
  'קרית ענבים',
  'מעלה החמישה',
  'בית זית',
  'גבעון החדשה',
  'נבי סמואל',
  'בית חנינא',
  'בית איכסא',
  'שועפט',
  'ענתות',
  'אלמון',
  'כוכב יעקב',
  'בית הורון',
  'גבעון',
  'בית נבלה',
  'בדו',
  'רמון',
  'חירן',
  'בית סוריק',
  'בית עור התחתית',
  'בית עור העליונה',
  'קלוניה',
  'לפיד',
  'שילה',
  'עלי',
  'מעלה לבונה',
  'רימונים',
  'כוכב השחר',
  'בית אריה',
  'עופרה',
  'פסגות',
  'קרני שומרון',
  'אלקנה',
  'שערי תקווה',
  'אורנית',
  'נופים',
  'נילי',
  'חשמונאים',
  'גבעת זאב',
  'אדם',
  'מזמוריה',
  'כפר אדומים',
  'אלון',
  'קדר',
  'תקוע',
  'נוקדים',
  'סוסיא',
  'שני',
  'אשכולות',
  'בני נעים',
  'חברון',
  'קרית ארבע',
  'בית הגדי',
  'אדורה',
  'נגוהות',
  'שמעה',
  'תלם',
  'בית יתיר',
  'מעון',
  'כרמל',
  'מצפה יאיר',
  'אביגיל',
  'שקד',
  'חרמש',
  'בית מואל',
  'חרמש',
  'רחלים',
  'איתמר',
  'ברכה',
  'עלי זהב',
  'גתים',
  'נחליאל',
  'דולב',
  'תלמון',
  'נעלה',
  'חלמיש',
  'נירית',
  'אטרת',
  'רמות',
  'נווה צוף',
  'חגי',
  'מתתיהו',
  'מכמש',
  'גבע בנימין',
  'פסגת זאב',
  'נווה יעקב',
  'פסגת זאב מזרח',
  'רמות אלון',
  'רמת שלמה',
  'רמות פולין',
  'רמות אשכול',
  'הר חומה',
  'הר גילה',
  'גילה',
  'ארמון הנציב',
  'תלפיות מזרח',
  'נוף ציון',
  'רמת רחל',
  'מלחה',
  'גונן',
  'בקעה',
  'מחנה יהודה',
  'שמואל הנביא',
  'סנהדריה',
  'רמת אשכול',
  'נווה יעקב',
  'פסגת זאב',
  'רמות',
  'גבעת המטוס',
  'עיר גנים',
  'קטמון',
  'גילה',
  'תלפיות',
  'בקעה',
  'ארנונה',
  'רמת רחל',
  'מלחה',
  'גונן',
  'בית הכרם',
  'קרית משה',
  'רחביה',
  'טלביה',
  'נחלת שבעה',
  'מחנה יהודה',
  'גאולה',
  'מאה שערים',
  'בתי אונגרין',
  'בתי ורשא',
  'שערי חסד',
  'נחלאות',
  'אבן ישראל',
  'מוסררה',
  'נחלת שמעון',
  'בוכרים',
  'שכונת התקווה',
  'כרם התימנים',
  'שכונת בורכוב',
  'פלורנטין',
  'נווה צדק',
  'שפירא',
  'יד אליהו',
  'הדר יוסף',
  'רמת אביב',
  'צהלה',
  'אפקה',
  'רמת החייל',
  'נווה אביבים',
  'רמת אביב ג\'',
  'רמת אביב ח\'',
  'צפון תל אביב',
  'נמל תל אביב',
  'יפו העתיקה',
  'עג\'מי',
  'גבעת עליה',
  'שכונת התקווה',
  'הפועל',
  'כרם התימנים',
  'נווה שאנן',
  'נווה עופר',
  'רמת גן',
  'גבעתיים',
  'בני ברק',
  'רמת השרון',
  'הרצליה',
  'כפר סבא',
  'רעננה',
  'הוד השרון',
  'אור יהודה',
  'יהוד',
  'מונוסון',
  'קרית אונו',
  'גבעת שמואל',
  'סביון',
  'קרית עקרון',
  'נס ציונה',
  'רחובות',
  'יבנה',
  'גדרה',
  'גן יבנה',
  'בית דגן',
  'אזור',
  'מזכרת בתיה',
  'נחלת יהודה',
  'בני עיש',
  'כפר חב"ד',
  'כפר מלל',
  'כפר טרומן',
  'כפר שמריהו',
  'אבן יהודה',
  'קדימה',
  'צורן',
  'פרדס חנה',
  'כרכור',
  'זכרון יעקב',
  'בנימינה',
  'גבעת עדה',
  'מאיר שפיה',
  'פורדיס',
  'עין עירון',
  'רגבים',
  'אלונה',
  'עמיקם',
  'בית שערים',
  'כפר יהושע',
  'נהלל',
  'כפר תבור',
  'דבוריה',
  'מגדל',
  'גינוסר',
  'כנרת',
  'פוריה',
  'אילניה',
  'כפר כמא',
  'לביא',
  'בית ירח',
  'דגניה א\'',
  'דגניה ב\'',
  'כנרת',
  'אשדות יעקב',
  'מסדה',
  'שדמות דבורה',
  'בית זרע',
  'תמר',
  'נאות הכיכר',
  'אלמוג',
  'ורד יריחו',
  'גלגל',
  'נטיב הגדוד',
  'בית הערבה',
  'קליה',
  'מצפה שלם',
  'מיצר',
  'מעלה עמוס',
  'נוה זוהר',
  'אבנת',
  'רוגלית',
  'פצאל',
  'מחולה',
  'מסכיות',
  'רותם',
  'חמדת',
  'ארגמן',
  'מחנה יפה',
  'בקעות',
  'רועי',
  'חמרה',
  'מכורה',
  'יטבתה',
  'גרופית',
  'שחרות',
  'אליפז',
  'תמנע',
  'נאות סמדר',
  'קטורה',
  'לוטן',
  'יהל',
  'נווה חריף',
  'צופר',
  'פארן',
  'ספיר',
  'שיטים',
  'עין יהב',
  'חצבה',
  'עידן',
  'עין תמר',
  'נאות הכיכר',
  'אלמוג',
  'ורד יריחו',
  'גלגל',
  'נטיב הגדוד',
  'בית הערבה',
  'קליה',
  'מצפה שלם',
  'מיצר',
  'מעלה עמוס',
  'נוה זוהר',
  'אבנת',
  'רוגלית',
  
  // קיבוצים
  'קיבוץ דגניה א\'',
  'קיבוץ דגניה ב\'',
  'קיבוץ עין חרוד',
  'קיבוץ גבעת ברנר',
  'קיבוץ נען',
  'קיבוץ יגור',
  'קיבוץ מעגן מיכאל',
  'קיבוץ שדות ים',
  'קיבוץ נחשון',
  'קיבוץ גזר',
  'קיבוץ חולדה',
  'קיבוץ גלויות',
  'קיבוץ רבדים',
  'קיבוץ יפעת',
  'קיבוץ מרחביה',
  'קיבוץ בית אלפא',
  'קיבוץ עין השופט',
  'קיבוץ מעברות',
  'קיבוץ גניגר',
  'קיבוץ כפר גלעדי',
  'קיבוץ דן',
  'קיבוץ שמיר',
  'קיבוץ גשר הזיו',
  'קיבוץ אילון',
  'קיבוץ לוחמי הגטאות',
  'קיבוץ עין דור',
  'קיבוץ מזרע',
  'קיבוץ ברעם',
  'קיבוץ סאסא',
  'קיבוץ מנרה',
  
  // מושבים
  'מושב נהלל',
  'מושב כפר יהושע',
  'מושב בלפוריה',
  'מושב גדעונה',
  'מ����� מרכז שפירא',
  'מושב בן זכאי',
  'מושב גני יוחנן',
  'מושב כפר ביל״ו',
  'מושב רמות השבים',
  'מושב צרעה',
  'מ����� נטעים',
  'מ����� תעוז',
  'מ����� עזריקם',
  'מ����� גדרה',
  'מ����� חגלה',
  'מ����� כפר אחים',
  'מ����� כפר הרי״ף',
  'מ����� בית עוזיאל',
  'מ����� אחיעזר',
  'מ����� בית חלקיה',
  'מ����� גן שורק',
  'מ����� כפר מנחם',
  'מ����� תירוש',
  'מ����� נחלה',
  'מ����� בית גמליאל',
  'מ����� כפר ורבורג',
  'מ����� פדיה',
  'מ����� שדה דוד',
  'מ����� שדה עוזיהו',
  'מ����� תלמי יפה',
  
  // יישובים קהילתיים
  'כפר ורדים',
  'מצפה נטופה',
  'חרשים',
  'שורש',
  'נווה אילן',
  'אבן ספיר',
  'נטף',
  'צור הדסה',
  'מבוא בית משיך',
  'כפר אדומים',
  'מעלה מכמש',
  'קדר',
  'תקוע',
  'נוקדים',
  'אלון שבות',
  'כפר עציון',
  'רוש צורים',
  'נווה דניאל',
  'בת עין',
  'אלמוג',
  'מצפה יריחו',
  'ורד יריחו',
  'גלגל',
  'נעמה',
  'יטבתה',
  'שחרות',
  'גרופית',
  'אליפז',
  'תמנע',
  'צופר',
  
  // כפרים ערביים
  'כפר כנא',
  'כפר מנדא',
  'עראבה',
  'סכנין',
  'דיר אל-אסד',
  'פקיעין',
  'חורפיש',
  'אבו סנאן',
  'יאנוח-ג\'ת',
  'כפר יאסיף',
  'ג\'ולס',
  'כסרא-סמיע',
  'רמה',
  'מגאר',
  'בית ג\'ן',
  'ערב אל-נעים',
  'דבוריה',
  'כפר תבור',
  'אכסאל',
  'נחף',
  'רינה',
  'מסעדה',
  'כפר קרע',
  'בסמת טבעון',
  'איכסאל',
  'כפר קאסם',
  'טירה',
  'טייבה',
  'קלנסווה',
  'ג\'לג\'וליה',
  'כפר ברא',
  'באר אל-מכסור',
  'זמר',
  'קדומים',
  'ברקאי',
  'רבבה',
  'חוסאן',
  'בידיא',
  'סרטבה',
  'עקרבא',
  'תל',
  'אום אל-קוטוף',
  'ביר נבאלא',
  'בית ליד',
  'בית עור',
  'דיר איסתיא',
  'חבלה',
  'כפר לקיף',
  'מרדא',
  'סלפית',
  'קפין',
  'רפידיה',
  'תל',
  'עזון',
  'ג\'ינסאפוט',
  'זיתא',
  'עמאתין',
  'קבאטיה',
  'מיתלון',
  'עראנה',
  'פחמה',
  'יעבד',
  'כפר ראעי',
  'רומאנה',
  'זבובה',
  'ריחאניה',
  'נזלת עיסא',
  'עין מאהל',
  'כפר מצר',
  'שבלי - אום אל-גנם',
  'סולם',
  'דחי',
  'כמון',
  'נין',
  'רומת הייב',
  'טל עדס',
  'מכר',
  'קאדיתא',
  'מג\'ד אל-כרום',
  'חורפיש',
  'כסרא-סמיע',
  'ג\'ת',
  'נחף',
  'כפר ורדים',
  'אעבלין',
  'דיר חנא',
  'כפר סומיי',
  'עיילבון',
  'רומאנה',
  'סח\'נין',
  'עראבה',
  'ברעם',
  'חורפיש',
  'פסוטה',
  'תרשיחא',
  'מעלות',
  'שלומי',
  'אדמית',
  'זרעית',
  'גורן',
  'נתיב השיירה',
  'אבן מנחם',
  'שתולה',
  'מרגליות',
  'יפתח',
  'דלתון',
  'רמות נפתלי',
  'מחניים',
  'אמירים',
  'כרמים',
  'פרוד',
  'סג\'ור',
  'יסוד המעלה',
  'קדש',
  'נוט',
  'מרום גולן',
  'חד נס',
  'אלוני הבשן',
  'גשור',
  'אפיק',
  'רמות',
  'אלי עד',
  'קלע',
  'חיספין',
  'אניעם',
  'גבעת יואב',
  'אלוני הבשן',
  'בני יהודה',
  'רמת גשימים',
  'נוב',
  'אבני איתן',
  'קדמת צבי',
  'חוסניה',
  'עלי',
  'מבוא חמה',
  'אורטל',
  'נמרוד',
  'שעל',
  'נווה אטיב',
  'קשת',
  'מעגן',
  'צוקים',
  'חמת גדר',
  'קיבוץ אפיק',
  'קיבוץ מעגן',
  'קיבוץ גשור',
  'קיבוץ אלוני הבשן',
  'קיבוץ חמת גדר',
  'קיבוץ גבעת יואב',
  'קיבוץ אפיק',
  'קיבוץ מעגן',
  'קיבוץ גשור',
  'קיבוץ אלוני הבשן',
  'קיבוץ חמת גדר',
  'קיבוץ גבעת יואב'
];

// Cache for dynamic cities list (defaults to static list)
let __citiesCache: string[] = israeliCities;

// Return current cities synchronously (cached or static)
export const getCitiesSync = (): string[] => __citiesCache;

// Attempt to load cities dynamically (fallback to static on any error)
export const loadCities = async (): Promise<string[]> => {
  try {
    // Fetch from official Israeli government data portal
    const response = await fetch('https://data.gov.il/api/3/action/datastore_search?resource_id=b7cf8f14-64a2-4b33-8d4b-edb286fdbd37&limit=2000');
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    
    if (data.success && data.result && data.result.records) {
      // Extract city names from the official data
      const cities = data.result.records
        .map((record: { [key: string]: string }) => record['שם_ישוב'] || record.name || record['שם יישוב'])
        .filter((name: string) => name && name.trim())
        .sort((a: string, b: string) => a.localeCompare(b, 'he'));
      
      if (cities.length > 0) {
        __citiesCache = cities;
        console.log(`Loaded ${cities.length} cities from official government data`);
        return __citiesCache;
      }
    }
    
    throw new Error('No valid data received from API');
  } catch (e) {
    console.warn('Failed to load cities from government API, using static list:', e);
    __citiesCache = israeliCities;
    return __citiesCache;
  }
};

export const filterCities = (query: string): string[] => {
  const list = __citiesCache;
  if (!query) return list.slice(0, 10);
  const q = query.trim().toLowerCase();
  const results = list.filter((c) => c.toLowerCase().includes(q) || c.toLowerCase().startsWith(q));
  return results.slice(0, 10);
};